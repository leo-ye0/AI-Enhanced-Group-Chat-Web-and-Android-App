<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OmniPal Chat</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Left Navbar -->
  <button id="toggleLeftNav" class="toggle-left-nav-btn" title="Toggle sidebar">â˜°</button>
  <nav class="left-nav hidden" id="leftNav">
    <div id="currentUserProfile" style="padding:16px;border-bottom:1px solid #374151;margin-bottom:8px">
      <div style="display:flex;align-items:center;gap:12px">
        <div id="userAvatar" onclick="document.getElementById('avatarInput').click()" style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:600;color:#000;cursor:pointer;background-size:cover;background-position:center" title="Click to upload avatar"></div>
        <input type="file" id="avatarInput" accept="image/*" style="display:none">
        <div style="flex:1">
          <div id="currentUsername" style="font-weight:600;font-size:14px;color:#000"></div>
          <div id="currentUserRole" style="font-size:11px;color:#666;margin-top:2px"></div>
        </div>
      </div>
    </div>
    <div class="nav-item active" onclick="toggleGroups()">ğŸ’¬ Groups</div>
    <div id="groupsList" class="hidden" style="padding:8px 20px;background:#f9fafb;border-bottom:1px solid #e5e7eb">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <span style="font-size:11px;font-weight:600;color:#6b7280">YOUR GROUPS</span>
        <button onclick="event.stopPropagation();createNewGroup()" style="padding:2px 6px;font-size:10px;background:#10a37f;color:white;border:none;border-radius:3px;cursor:pointer">+</button>
      </div>
      <div id="groupsContainer"></div>
    </div>
    <div class="nav-item">ğŸ“¨ Direct Msgs</div>
  </nav>
  <div class="resize-handle" id="leftResize"></div>

  <div class="container">
    <div class="auth" id="auth">
      <h1>OmniPal Chat</h1>
      <p>Create an account or log in to join the chat.</p>
      <div class="row">
        <input id="username" placeholder="Username">
        <input id="password" placeholder="Password" type="password">
      </div>
      <div class="row">
        <button id="signupBtn">Sign Up</button>
        <button id="loginBtn">Log In</button>
      </div>
      <div class="hint">Hint: Mention @bot to get AI responses. Use /project analyze, /project status, or /tasks for project management.</div>
      <div id="authMsg" class="msg"></div>
    </div>
    <div class="chat hidden" id="chat">
      <div class="header">
        <h2>OmniPal Chat</h2>
        <div class="header-buttons">
          <input type="file" id="fileInput" accept=".pdf,.docx,.txt" style="display: none;">
          <button id="uploadBtn">Upload File</button>
          <button id="clearBtn">Clear Chat</button>
          <button id="logoutBtn">Log Out</button>
        </div>
      </div>
      <div class="chat-container">
        <div id="messages" class="messages"></div>
        <div class="composer">
          <div class="mention-dropdown hidden" id="mentionDropdown"></div>
          <button id="botToggle" class="bot-toggle-btn" title="Toggle bot always-on">ğŸ¤–</button>
          <select id="llmToneDropdown" class="tone-dropdown" title="Bot response tone">
            <option value="none">ğŸ¤– Default</option>
            <option value="professional">ğŸ¤– Pro</option>
            <option value="casual">ğŸ¤– Casual</option>
            <option value="concise">ğŸ¤– Brief</option>
            <option value="detailed">ğŸ¤– Detail</option>
            <option value="empathetic">ğŸ¤– Warm</option>
            <option value="direct">ğŸ¤– Direct</option>
          </select>
          <select id="toneDropdown" class="tone-dropdown" title="Your message tone">
            <option value="none">ğŸ‘¤ Default</option>
            <option value="professional">ğŸ‘¤ Pro</option>
            <option value="casual">ğŸ‘¤ Casual</option>
            <option value="concise">ğŸ‘¤ Brief</option>
            <option value="detailed">ğŸ‘¤ Detail</option>
            <option value="empathetic">ğŸ‘¤ Warm</option>
            <option value="direct">ğŸ‘¤ Direct</option>
          </select>
          <input id="chatInput" placeholder="Type a messageâ€¦ (use @bot or / for commands)">
          <button id="sendBtn">Send</button>
        </div>
      </div>
    </div>
    <div class="file-preview hidden" id="filePreview">
      <div class="preview-header">
        <h3 id="previewTitle">File Preview</h3>
        <button id="closePreview">Ã—</button>
      </div>
      <div class="preview-content" id="previewContent"></div>
    </div>
    <!-- Right Context Sidebar -->
    <div class="resize-handle" id="rightResize"></div>
    <div class="right-sidebar hidden" id="rightSidebar">
      <div class="sidebar-section">
        <h3 onclick="toggleSection('projectPulse')" style="cursor:pointer;user-select:none">ğŸ¯ PROJECT PULSE</h3>
        <div id="projectPulse" style="display:none;flex-direction:column;gap:8px"></div>
      </div>

      <div class="sidebar-section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <h3 onclick="toggleSection('sidebarMeetings')" style="margin:0;cursor:pointer;user-select:none">ğŸ“… MEETINGS</h3>
          <div style="display:flex;gap:4px">
            <button id="addMeetingSidebar" class="toggle-btn">+</button>
            <button id="expandMeetings" class="toggle-btn">All</button>
          </div>
        </div>
        <div id="sidebarMeetings" class="sidebar-meetings" style="display:none"></div>
      </div>

      <div class="sidebar-section">
        <h3 onclick="toggleSection('tasksDecisionsContent')" style="cursor:pointer;user-select:none">ğŸ“‹ TASKS & DECISIONS</h3>
        <div id="tasksDecisionsContent" style="display:none">
          <div class="tab-header">
            <div class="tab active" id="tasksTab">TASKS</div>
            <div class="tab" id="archivedTab">ARCHIVED</div>
            <div class="tab" id="decisionsTab">DECISIONS</div>
          </div>
          <div class="tab-content" id="tasksContent">
            <div id="sidebarTasks" class="sidebar-tasks"></div>
            <div id="sidebarTaskInput" class="hidden" style="margin:8px 0;padding:8px;background:#f9fafb;border-radius:4px">
              <input id="sidebarNewTaskContent" placeholder="Enter task..." style="width:100%;padding:6px;border:1px solid #ddd;border-radius:3px;font-size:11px;margin-bottom:4px">
              <input type="date" id="sidebarNewTaskDueDate" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:3px;font-size:11px;margin-bottom:4px">
              <select id="sidebarNewTaskAssignee" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:3px;font-size:11px">
                <option value="">Unassigned</option>
              </select>
              <div style="display:flex;gap:4px;margin-top:4px">
                <button id="sidebarSaveTaskBtn" class="toggle-btn" style="flex:1;font-size:10px">Save</button>
                <button id="sidebarCancelTaskBtn" class="toggle-btn" style="flex:1;font-size:10px">Cancel</button>
              </div>
            </div>
            <button id="addTaskBtnSidebar" class="add-btn">+ Add</button>
          </div>
          <div class="tab-content hidden" id="archivedContent">
            <div id="sidebarArchived" class="sidebar-tasks"></div>
          </div>
          <div class="tab-content hidden" id="decisionsContent">
            <div id="sidebarDecisions" class="sidebar-decisions"></div>
            <button onclick="clearDecisions()" class="add-btn" style="background:#dc2626;margin-top:8px">ğŸ—‘ï¸ Clear</button>
          </div>
        </div>
      </div>

      <div class="sidebar-section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <h3 onclick="toggleSection('activeConflicts')" style="margin:0;cursor:pointer;user-select:none">ğŸ—³ï¸ ACTIVE VOTES</h3>
          <button onclick="startManualVote()" class="toggle-btn" style="font-size:10px">+ Vote</button>
        </div>
        <div id="activeConflicts" class="active-conflicts" style="display:none"></div>
      </div>

      <div class="sidebar-section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <h3 onclick="toggleSection('teamRoles')" style="margin:0;cursor:pointer;user-select:none">ğŸ‘¥ TEAM ROLES</h3>
          <button onclick="editMyRoles()" class="toggle-btn" style="font-size:10px">âœï¸ Edit</button>
        </div>
        <div id="teamRoles" class="team-roles" style="display:none"></div>
      </div>

      <div class="sidebar-section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <h3 onclick="toggleSection('groupBrain')" style="margin:0;cursor:pointer;user-select:none">ğŸ“‚ GROUP BRAIN</h3>
          <div style="display:flex;gap:4px">
            <button onclick="document.getElementById('brainFileInput').click()" class="toggle-btn" style="font-size:10px">â¬†ï¸ Upload</button>
            <button id="toggleBrainSummaries" class="toggle-btn">Hide</button>
          </div>
        </div>
        <input type="file" id="brainFileInput" accept=".pdf,.docx,.txt" style="display:none">
        <div id="groupBrain" class="brain-list" style="display:none"></div>
      </div>
    </div>

    <div class="right-column hidden" id="rightColumn">
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h3>ğŸ“ Uploaded Files</h3>
          <button id="toggleSummaries" class="toggle-btn">Hide Summaries</button>
        </div>
        <div class="file-list" id="fileList">
          <div class="no-files">No files uploaded yet</div>
        </div>
      </div>
      <div class="task-panel" id="taskPanel">
        <div class="task-header">
          <h3>ğŸ“‹ Tasks</h3>
          <button id="addTaskBtn" class="toggle-btn">+ Add</button>
        </div>
        <div style="padding:4px 8px;display:flex;gap:4px;border-bottom:1px solid #e5e7eb">
          <select id="taskSortBy" style="padding:2px 4px;font-size:10px;border:1px solid #ddd;border-radius:3px;flex:1">
            <option value="recent">Recent</option>
            <option value="due_date">Due Date</option>
            <option value="status">Status</option>
          </select>
          <select id="taskFilterUser" style="padding:2px 4px;font-size:10px;border:1px solid #ddd;border-radius:3px;flex:1">
            <option value="all">All</option>
          </select>
          <select id="taskFilterStatus" style="padding:2px 4px;font-size:10px;border:1px solid #ddd;border-radius:3px;flex:1">
            <option value="all">All</option>
            <option value="pending">Pending</option>
            <option value="completed">Done</option>
          </select>
        </div>
        <div class="task-input hidden" id="taskInput">
          <input id="newTaskContent" placeholder="Enter task...">
          <div style="display:flex;gap:4px;margin-top:4px">
            <button id="saveTaskBtn" class="toggle-btn" style="flex:1">Save</button>
            <button id="cancelTaskBtn" class="toggle-btn" style="flex:1">Cancel</button>
          </div>
        </div>
        <div class="task-list" id="taskList">
          <div class="no-tasks">No tasks yet. AI will auto-detect tasks from your messages!</div>
        </div>
      </div>
      <div class="meeting-panel" id="meetingPanel">
        <div class="meeting-header">
          <h3>ğŸ“… Meetings</h3>
          <button id="addMeetingBtn" class="toggle-btn">+ Add</button>
        </div>
        <div class="meeting-list" id="meetingList">
          <div class="no-meetings">No meetings scheduled</div>
        </div>
      </div>
      <input type="file" id="transcriptInput" accept=".txt,.vtt,.srt" style="display:none">
    </div>
    <div class="meeting-modal hidden" id="assignModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ‘¤ Assign Task</h3>
          <button id="closeAssignModal">Ã—</button>
        </div>
        <div class="modal-body">
          <div id="userCheckboxes"></div>
          <button id="saveAssignBtn" class="toggle-btn" style="width:100%;margin-top:8px">Save Assignment</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="attendeesModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ‘¥ Meeting Attendees</h3>
          <button id="closeAttendeesModal">Ã—</button>
        </div>
        <div class="modal-body">
          <div id="attendeeCheckboxes"></div>
          <button id="saveAttendeesBtn" class="toggle-btn" style="width:100%;margin-top:8px">Save Attendees</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="dueDateModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ“… Set Due Date</h3>
          <button id="closeDueDateModal">Ã—</button>
        </div>
        <div class="modal-body">
          <input id="dueDateInput" type="date" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px">
          <button id="saveDueDateBtn" class="toggle-btn" style="width:100%;margin-top:8px">Save Due Date</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="durationModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>â±ï¸ Set Duration</h3>
          <button id="closeDurationModal">Ã—</button>
        </div>
        <div class="modal-body">
          <input id="durationInput" type="number" placeholder="Duration in minutes" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px">
          <button id="saveDurationBtn" class="toggle-btn" style="width:100%;margin-top:8px">Save Duration</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="zoomLinkModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ”— Update Zoom Link</h3>
          <button id="closeZoomLinkModal">Ã—</button>
        </div>
        <div class="modal-body">
          <input id="zoomLinkInput" type="url" placeholder="Enter Zoom link" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px">
          <button id="saveZoomLinkBtn" class="toggle-btn" style="width:100%;margin-top:8px">Save Zoom Link</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="meetingModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ“… Schedule Meeting</h3>
          <button id="closeMeetingModal">Ã—</button>
        </div>
        <div class="modal-body">
          <input id="meetingTitle" placeholder="Meeting title">
          <input id="meetingDatetime" type="datetime-local">
          <input id="meetingDuration" type="number" placeholder="Duration (minutes)" value="30">
          <input id="meetingZoomLink" placeholder="Paste your Zoom link (e.g., https://zoom.us/j/123456789)">
          <div style="font-size:11px;opacity:0.7;margin-top:4px">
            ğŸ“ Get your personal Zoom link: <a href="https://zoom.us/profile" target="_blank" style="color:#4f46e5">zoom.us/profile</a> â†’ Personal Meeting ID
          </div>
          <div style="margin-top:8px;position:relative">
            <button id="attendeeDropdownBtn" type="button" style="width:100%;padding:8px;border:1px solid #374151;border-radius:8px;background:#0b1220;color:#e2e8f0;text-align:left;cursor:pointer;font-size:12px">ğŸ‘¥ Select Attendees</button>
            <div id="meetingAttendeeCheckboxes" class="hidden" style="position:absolute;top:100%;left:0;right:0;max-height:150px;overflow-y:auto;background:#0b1220;border:1px solid #374151;border-radius:8px;margin-top:2px;padding:8px;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,0.3)"></div>
          </div>
          <button id="uploadTranscriptBtn" class="toggle-btn" style="width:100%;margin-top:8px;display:none">ğŸ“„ Upload Transcript</button>
          <div id="suggestedTimes" class="suggested-times"></div>
          <button id="createMeetingBtn" class="toggle-btn" style="width:100%;margin-top:8px">Create Meeting</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="milestoneModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>âœï¸ Edit Milestone</h3>
          <button id="closeMilestoneModal">Ã—</button>
        </div>
        <div class="modal-body">
          <input id="milestoneTitle" placeholder="Milestone title">
          <input id="milestoneStartDate" type="date">
          <input id="milestoneEndDate" type="date">
          <button id="saveMilestoneBtn" class="toggle-btn" style="width:100%;margin-top:8px">Save Changes</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="voteModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="voteModalTitle">ğŸ—³ï¸ Cast Your Vote</h3>
          <button onclick="closeVoteModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <textarea id="voteReasoning" placeholder="Please provide your reasoning for this vote..." style="width:100%;height:80px;padding:8px;border:1px solid #374151;border-radius:4px;background:#0b1220;color:#e2e8f0;resize:vertical"></textarea>
          <button onclick="submitVote()" class="toggle-btn" style="width:100%;margin-top:8px">Submit Vote</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="startVoteModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ—³ï¸ Start Team Vote</h3>
          <button onclick="closeStartVoteModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <textarea id="startVoteQuestion" placeholder="What should the team vote on?\n\nExample: Should we use Method A or Method B for the analysis?" style="width:100%;height:80px;padding:8px;border:1px solid #374151;border-radius:4px;background:#0b1220;color:#e2e8f0;resize:vertical"></textarea>
          <button onclick="submitStartVote()" class="toggle-btn" style="width:100%;margin-top:8px">Start Vote</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="editRolesModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>âœï¸ Edit My Roles</h3>
          <button onclick="closeEditRolesModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <textarea id="rolesInput" placeholder="Enter your roles (comma-separated)&#10;&#10;Examples:&#10;- Frontend Developer, UI Designer&#10;- Backend Engineer, DevOps&#10;- Product Manager, Scrum Master" style="width:100%;height:100px;padding:8px;border:1px solid #374151;border-radius:4px;background:#0b1220;color:#e2e8f0;resize:vertical"></textarea>
          <button onclick="saveMyRoles()" class="toggle-btn" style="width:100%;margin-top:8px">Save Roles</button>
        </div>
      </div>
    </div>
    <div class="meeting-modal hidden" id="clearMilestonesModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ—‘ï¸ Clear All Milestones</h3>
          <button onclick="closeClearMilestonesModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <p style="margin-bottom:16px;color:#e2e8f0">Are you sure you want to delete all milestones? This action cannot be undone.</p>
          <div style="display:flex;gap:8px">
            <button onclick="closeClearMilestonesModal()" class="toggle-btn" style="flex:1;background:#374151">Cancel</button>
            <button onclick="confirmClearMilestones()" class="toggle-btn" style="flex:1;background:#dc2626">Delete All</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="app.js"></script>
</body>
</html>
